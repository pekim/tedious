---
layout: default
title: F.E.Q.
---

<h1>Frequently Encountered Problems (F.E.Q.)</h1>

<dl>
    <dt>
        <h2>Any Problem</h2>
    </dt>

    <dd>
        <p>First step to debug any problems is to ensure that
            <a href="https://github.com/tediousjs/tedious/releases">tedious is up to date.</a></p>
        <p>If you're using tediousjs/mssql, make sure it's up to date, as well as its tedious dependency in
            package.json.
            <br>
            Note: tediousjs/mssql is <strong>no longer being actively maintained</strong>
        </p>
    </dd>
    <br />
    <dt>
        <h2>Setting up config</h2>
    </dt>
    <dd>
        <p>To set up a configuration object for a Connection to SQL server, see <a href="api-connection.html">connection
                page.</a></p>
        <p>To set up configuration for running tests locally, see <a href="tests.html">tests page.</a></p>
    </dd>
    <br />
    <dt>
        <h2>Connection to local SQL Server</h2>
    </dt>
    <dd>
        <h3>SQL Server Configurations</h3>

        <p>Ensure SQL Server Browser and <a
                href="https://stackoverflow.com/questions/11632849/how-to-check-if-sql-server-agent-is-running">SQL
                Server Agent is running</a> (Agent can only run on SQL Server Developer/Enterprise, NOT SQL Server
            Express).</p>
        <p><a
                href="https://www.habaneroconsulting.com/stories/insights/2015/tcpip-is-disabled-by-default-in-microsoft-sql-server-2014">Enable
                TCP/IP port</a> via SQL Configuration Manager
            (<code>C:\Windows\SysWOW64\SQLServerManager14.msc</code> for windows).</p>
        <p>Ensure user is enabled: SQL Server Management Studio -> Security -> logins -> enable user (that matches
            the userName in the '<a href="getting-started.html">config</a>' object in Tedious).</p>


        <h3>Tedious Configurations</h3>

        <p>
            Ensure <a
                href="https://sqlandme.com/2013/05/01/sql-server-finding-tcp-port-number-sql-instance-is-listening-on/">port
                number of the server</a>
            matches the port number in the 'config' object, and ensure the port number is in the options field of
            the config object itself, and NOT the Authentication options.
        </p>
        <p>E.g.,</p>
        {% highlight javascript %}
        var config = {
            server: 'localhost',
            authentication: {
              type: 'default',
              options: {
                userName: 'sa', //Username 'sa' was added to server 'users'
                password: 'Password_123', //Password set up during addition of 'sa' user. 
              }
            },
            options: {		
              port: 60543, //This port was specific to my server. Yours might be different. 
            }
          };
        {% endhighlight %}

    </dd>
    <br />
    <dt>
        <h2>Providing a client ID when using <code>azure-active-directory-password</code></h2>
    </dt>
    <dd>
        <p>The clientId field is now mandatory when using the <code>azure-active-directory-password</code> 
            authentication type since the provided default client ID has been removed from Tedious. 
            That default client ID will expire in the near future and stop working.</p>
        <p>Please refer to the <a href="https://tediousjs.github.io/tedious/api-connection.html#function_newConnection">connection</a> 
            API documentation for more information and alternate Azure connection methods</p>
    </dd>
    <br />
    <dt>
        <h2>Remote Azure Connection</h2>
    </dt>
    <dd>
        <p>Tedious version 6.3.0 and above is required for MSI Authentication.</p>
        <p>Check configuration in Active Directory's Firewall.</p>
    </dd>
    <br />
    <dt>
        <h2>"Requests can only be made in the LoggedIn state, not the SentClientRequest state"</h2>
    </dt>
    <dd>
        <p>Only one query can be executed on a connection at a time. You need to wait until the request callback is
            executed, either with an error or with the result before making another request.
            <br>
            (Refer to the <a
                href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tds/ce1cef02-f43c-4e37-a190-aaa444b96360">TDS
                protocol state diagram </a>
            [bottom-half of the diagram] for a high level understanding of the TDS lifecycle).
        </p>
    </dd>
    <br />
    <dt>
        <h2>tediousjs > tedious-connection-pool and node-mssql</h2>
    </dt>
    <dd>
        <p>Both of these repositories are not being actively maintained, however, still valid to some extent.</p>
        <p>If using either of these, ensure that you're using the latest versions and that their package.json has the <a
                href="https://github.com/tediousjs/tedious/releases">latest tedious version</a> as its dependency</p>
    </dd>
    <br />
    <dt>
        <h2>JavaScript number type limitation</h2>
    </dt>
    <dd>
        <p>If the number you're trying to insert is not in -9007199254740991 and 9007199254740991 (inclusive), use
            VarChar type instead.</p>
    </dd>
    <br />
    <dt>
        <h2>Connecting to SQL Server 2000</h2>
    </dt>
    <dd>
        <p>use TDS version <code>7_1</code> specified in the config: </p>
        {% highlight javascript %}
        var config = {
            options: {		
                ...,
                tdsVersion: '7_1'
            }
          };
        {% endhighlight %}
    </dd>
    <br />
    <dt>
        <h2>The Behavior Change of connect() function</h2>
    </dt>
    <dd>
        <p>
            Originally the <code>connect()</code> is used like this: 
{% highlight javascript %}
    const connection = new Connection(config);
    connection.on('connect', (err) => {});
    connection.connect();
{% endhighlight %}
            It has to work with a event handler function call: <code>connectionObject.on('connect',callback())</code>. 
            Users still have the option to use <code>connect()</code> in this fashion. 
        </p>
        <p>
            However, the new <code>connect()</code> can be used like this:
{% highlight javascript %}
    const connection = new Connection(config);
    connection.connect((err) => {});
{% endhighlight %}
            Users can pass the event handler call back function as a parameter, the <code>connect()</code> will 
            handle the supported events : <code>connect</code> and <code>error</code> based on the callback function
            that is passed in. 
        </p>
        <p>
            The change not only makes this part of the code simpler, but it was also implemented to deprecate 
            automatically opening a connection when building a Connection instance. 
            Here are links to the related original issue and changes:
            <a href="https://github.com/tediousjs/tedious/pull/730" target="_blank"><i><b>730</b></i></a>,
            <a href="https://github.com/tediousjs/tedious/pull/1069" target="_blank"><i><b>1069</b></i></a>,
            <a href="https://github.com/tediousjs/tedious/pull/1102" target="_blank"><i><b>1102</b></i></a>,
            <a href="https://github.com/tediousjs/tedious/pull/1145" target="_blank"><i><b>1145</b></i></a>,
            <a href="https://github.com/tediousjs/tedious/pull/1202" target="_blank"><i><b>1202</b></i></a>
        </p>  
    </dd>
    <br />
    <dt>
        <h2>Using NTLM authentication with Node.js 17</h2>
    </dt>
    <dd>
        <p>
            Node 17 has upgraded to OpenSSL 3.0, which considers md4 encryption a legacy type due to md4 being insecure. 
            Since NTLM uses md4 encryption, you must enable the `--openssl-legacy-provider` command line option in order to use
            NTLM authentication with Node 17. If you attempt to use NTLM without the option enabled, 
            it will throw an error and not allow you to connect.
        </p>
        <p>
            Enabling the flag in <code>package.json:</code>
{% highlight javascript %}
{
    "scripts": {
        "start": "node --openssl-legacy-provider example.js"
    }
}
{% endhighlight %}
        </p>
        <p>
            Enabling the flag in the command line:
{% highlight plaintext %}
C:\Tedious> node --openssl-legacy-provider example.js
{% endhighlight %}
        </p>
        <p>
            You can find more information on this here:
            <ul>
                <li><a href=https://www.openssl.org/docs/manmaster/man7/OSSL_PROVIDER-legacy.html>OpenSSL 3 Documentation</a></li>
                <li><a href=https://nodejs.org/en/blog/release/v17.0.0>Node 17 Changelog</a></li>
            </ul>
        </p>
    </dd>
    <br />
    <dt>
        <h2>The relations between <code>options.trustServerCertificate, options.encrypt,</code> and <code>options.cryptoCredentialDetails</code></h2>
    </dt>
    <dd>
        <ul>
            <li>
                If your server has encryption set to 'ON' or 'REQ', and:
                <ul>
                    <li>
                        <code>encrypt = true</code> in your config, the driver will start TLS
                        with the corresponding <code>trustServerCertificate</code> settings.
                    </li>
                    <li>
                        <code>encrypt = false</code>, the driver will throw an error 
                        stating that <code>Server requires encryption, set 'encrypt' option to true.</code> then close the connection.
                    </li>
                </ul>
            </li>
            <li>
                If <code>encrypt = true</code> and <code>trustServerCertificate = false</code>, 
                then you may be required to provide your certificate details using <code>cryptoCredentialsDetails</code>. 
                Details on how to provide the <code>cryptoCredentialsDetails</code> object can be found in the
                 <a href="/api-connection.html">connection</a> page of the documentation.
            </li>
            <li>
                If <code>encrypt = false</code>, then <code>trustServerCertificate</code> is ignored.
            </li>
        </ul>

    </dd>
    <br />
    <dt>
        <h2>TLS 1.0 compatibility with Node 12 and newer</code></h2>
    </dt>
    <dd>
        <p>
            The default TLS settings were tightened in Node 12 and newer, requiring at least TLS 1.2 or above. You can find documentation
            on how to upgrade your server to TLS 1.2 
            <a href="https://support.microsoft.com/en-us/topic/kb3135244-tls-1-2-support-for-microsoft-sql-server-e4472ef8-90a9-13c1-e4d8-44aad198cdbe">here</a>.
        </p>
        <p>
            It is NOT RECOMMENDED to continue to use TLS 1.0 due to the associated security risks. However, as a last resort,
            you can continue to use TLS 1.0 by adding the <code>--tls-min-v1.0</code> command line flag, 
            or by passing a custom <code>cryptoCredentialsDetails</code> option to the Connection constructor that specifies 
            <code>minVersion: 'TLSv1'</code>.
        </p>
    </dd>
    <br />
    <dt>
        <h2>How Tedious handles Unicode datatype conversions when using parameters</h2>
    </dt>
    <dd>
        <p>
            Since all JavaScript strings are Unicode, when using a non-Unicode datatype (such as VarChar), then Tedious will do the conversion 
            from a Unicode string to a non-Unicode string using the <a href="https://www.npmjs.com/package/iconv-lite">iconv-lite library</a>  then send the data to the server. 
            The conversion might not match the way SQL Server would do the conversion in some edge cases 
            (like characters that can't be translated to the target encoding).
        </p>
        <p>
            There are some alternatives to this. You can use a Unicode datatype as the parameter type. Tedious will send the string in the SQL server's default encoding, 
            then the SQL server will do the conversion, which may cause a performance hit in certain situations.
        </p>
        <p>
            Another option is to use varbinary, 
            if the binary data is encoded in the matching database column encoding. This will bypass any conversion at any point.
        </p>
    </dd>
    <br />
    <dt>
        <h2>Why use aggregate error instead of the normal error object</h2>
    </dt>
    <dd>
        <p>
            Users has reported issues that <code>Request</code> and <code>connection</code> do not return the full backtrace of errors.
        </p>
        <p>
            For <code>Request</code>, this is the related issue: <a href="https://github.com/tediousjs/tedious/issues/968">Issue 968</a></p>
            In order to review all the errors, an aggregate error object is ideal to record the errors along the process 
            and allow users to access them easily at the end. To output the errors, users need to do an additional step to  
            output each error one by one using a loop. 
        </p>
        <p>
            For <code>Connection</code>, Tedious used to overwrite the errors during the Azure token retrieval process, and returns a generic 
            error message. With this behavior, users will miss the details from the original error from the SQL server. Using 
            an aggregate error object, Tedious stacks both the generic error message along with the original error object 
            from the SQL server. To output the errors, users need to do an additional step to 
            output each error one by one using a loop. 
        </p>
    </dd>
    <br />
    <dt>
        <h2>Other</h2>
    </dt>
    <dd>
        <p>For more complex issues, please raise an issue on the <a
                href="https://github.com/tediousjs/tedious/issues">github page!</a></p>
        <p>If you've found a solution to what you think may be a common problem, please make a <a
                href="https://github.com/tediousjs/tedious/tree/gh-pages">pull request on gh-pages branch</a> with the
            problem and solution,
            or <a href="https://github.com/tediousjs/tedious/issues">raise an issue </a>.</p>
    </dd>
</dl>