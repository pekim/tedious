---
layout: default
title: API - Request
---

<h1>Request</h1>

<p>
  A <code>Request</code> instance represents a request that can be executed on a connection.
</p>

<ul class="toc">
  <li><a href="#function_newRequest">new Request(sql, callback)</a></li>
  <li><a href="#event_columnMetadata">Event: 'columnMetadata'</a></li>
  <li><a href="#event_prepared">Event: 'prepared'</a></li>
  <li><a href="#event_row">Event: 'row'</a></li>
  <li><a href="#event_done">Event: 'done'</a></li>
  <li><a href="#event_doneInProc">Event: 'doneInProc'</a></li>
  <li><a href="#event_doneProc">Event: 'doneProc'</a></li>
  <li><a href="#event_returnValue">Event: 'returnValue'</a></li>
  <li><a href="#function_addParameter">request.addParameter(name, type, value, [options])</a></li>
  <li><a href="#function_addOutputParameter">request.addOutputParameter(name, type, [value], [options])</a></li>
  <li><a href="#function_pause">request.pause()</a></li>
  <li><a href="#function_resume">request.resume()</a></li>
</ul>

<h2 id="function_newRequest">new Request(sql, callback)</h2>
{% highlight javascript %}
var Request = require('tedious').Request;

request = new Request("select 42, 'hello world'", function(err, rowCount) {
  ...
});
connection.execSql(request);
{% endhighlight %}

<div class="argument">
  <div class="name">sql</div>
  <div class="description">
    <p>
      The SQL statement to be executed
      (or a procedure name, if the request is to be used with
      <a href="api-connection.html#function_callProcedure"><code>connection.callProcedure</code></a>).
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">callback</div>
  <div class="description">
    <span class="function">function (err, rowCount, rows) { }</span>
    <p>
      The callback is called when the request has completed, either successfully or with an error.
      If an error occurs during execution of the statement(s), then <code>err</code> will describe the error.
    </p>
    <p>
      As only one request at a time may be executed on a connection, another request should not
      be initiated until this callback is called.
    </p>
    <div class="argument">
      <div class="name">err</div>
      <div class="description">
        <p>
          If an error occured, an error object.
        </p>
      </div>
    </div>
      <div class="argument">
          <div class="name">rowCount</div>
          <div class="description">
              <p>
                  The number of rows emitted as result of executing the SQL statement.
              </p>
          </div>
      </div>
      <div class="argument">
          <div class="name">rows</div>
          <div class="description">
              <p>
                  Rows as a result of executing the SQL statement.
              </p>
              <p>
                  Will only be avaiable if Connection's
                  <code>config.options.rowCollectionOnRequestCompletion</code>
                  is <code>true</code>.
              </p>
          </div>
      </div>
  </div>
</div>

<h2 id="event_columnMetadata">Event: columnMetadata</h2>
{% highlight javascript %}
request.on('columnMetadata', function (columns) { });
{% endhighlight %}

<p>
  This event, describing result set columns, will be emitted before <code>row</code> events are emitted.
  This event may be emited multiple times when more than one recordset is produced by the statement.
</p>
<div class="argument">
  <div class="name">columns</div>
  <div class="description">
    <p>
      An array like object, where the columns can be accessed either by index or name.
      Columns with a name that is an integer are not accessible by name,
      as it would be interpreted as an array index.
    </p>
    <p>
      Each column has these properties.
    </p>
    <dl>
      <dt>
        <code>colName</code>
      </dt>
      <dd>
        The column's name.
      </dd>

      <dt>
        <code>type.name</code>
      </dt>
      <dd>
        The column's type, such as VarChar, Int or Binary.
      </dd>

      <dt>
        <code>precision</code>
      </dt>
      <dd>
        The precision. Only applicable to numeric and decimal.
      </dd>

      <dt>
        <code>scale</code>
      </dt>
      <dd>
        The scale. Only applicable to numeric, decimal, time, datetime2 and datetimeoffset.
      </dd>

      <dt>
        <code>dataLength</code>
      </dt>
      <dd>
        The length, for char, varchar, nvarchar and varbinary.
      </dd>
    </dl>
  </div>
</div>

<h2 id="event_prepared">Event: prepared</h2>
{% highlight javascript %}
request.on('prepared', function () { });
{% endhighlight %}

<p>
  The request has been <a href="api-connection.html#function_prepare">prepared</a>
  and can be used in subsequent calls to
  <a href="api-connection.html#function_execute">execute</a> and
  <a href="api-connection.html#function_unprepare">unprepare</a>.
</p>

<h2 id="event_row">Event: row</h2>
{% highlight javascript %}
request.on('row', function (columns) { });
{% endhighlight %}

<p>
  A row resulting from execution of the SQL statement.
</p>
<div class="argument">
  <div class="name">columns</div>
  <div class="description">
    <p>
      An array or object (depends on <code>config.options.useColumnNames</code>), where the columns can be accessed by index/name.
      Each column has two properties, <code>metadata</code> and <code>value</code>.
    </p>
    <dl>
      <dt>
        <code>metadata</code>
      </dt>
      <dd>
        The same data that is exposed in the <code>columnMetadata</code> event.
      </dd>

      <dt>
        <code>value</code>
      </dt>
      <dd>
        <p>
          The column's value.
          It will be <code>null</code> for a <code>NULL</code>.
        </p>
        <p>
          If there are multiple columns with the same name, then this will be an array of the values.
	</p>
      </dd>
    </dl>
  </div>
</div>

<h2 id="event_done">Event: done</h2>
{% highlight javascript %}
request.on('done', function (rowCount, more, rows) { });
{% endhighlight %}

<p>
  All rows from a result set have been provided (through <code>row</code> events).
  This token is used to indicate the completion of a SQL statement. As multiple SQL statements can
  be sent to the server in a single SQL batch, multiple <code>done</code> events can be generated.
  An <code>done</code> event is emited for each SQL statement in the SQL batch except variable declarations.
  For execution of SQL statements within stored procedures, <code>doneProc</code> and <code>doneInProc</code>
  events are used in place of <code>done</code> events.
</p>
<p>
  If you are using <a href="api-connection.html#function_execSql">execSql</a> then SQL server may treat 
  the multiple calls with the same query as a stored procedure.  When this occurs, the
  <a href="#event_doneProc"><code>doneProc</code></a> or <a href="#event_doneInProc"><code>doneInProc</code></a>
  events may be emitted instead.  You must handle both events to ensure complete coverage.
</p>
<div class="argument">
  <div class="name">rowCount</div>
  <div class="description">
    <p>
      The number of result rows.
      May be <code>undefined</code> if not available.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">more</div>
  <div class="description">
    <p>
      If there are more results to come (probably because multiple statements are being executed),
      then <code>true</code>.
    </p>
  </div>
</div>
<div class="argument">
    <div class="name">rows</div>
    <div class="description">
        <p>
            Rows as a result of executing the SQL statement.
        </p>
        <p>
            Will only be avaiable if Connection's
            <code>config.options.rowCollectionOnDone</code>
            is <code>true</code>.
        </p>
    </div>
</div>

<h2 id="event_doneInProc">Event: doneInProc</h2>
{% highlight javascript %}
request.on('doneInProc', function (rowCount, more, rows) { });
{% endhighlight %}

<p>
  Indicates the completion status of a SQL statement within a stored procedure. All rows from a statement
  in a stored procedure have been provided (through <code>row</code> events).
</p>
<p>
  This event may also occur when executing multiple calls with the same query using 
  <a href="api-connection.html#execSql"><code>execSql</code></a>.
</p>
<div class="argument">
  <div class="name">rowCount</div>
  <div class="description">
    <p>
      The number of result rows.
      May be <code>undefined</code> if not available.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">more</div>
  <div class="description">
    <p>
      If there are more result sets to come,
      then <code>true</code>.
    </p>
  </div>
</div>
<div class="argument">
    <div class="name">rows</div>
    <div class="description">
        <p>
            Rows as a result of executing the SQL.
        </p>
        <p>
            Will only be avaiable if Connection's
            <code>config.options.rowCollectionOnDone</code>
            is <code>true</code>.
        </p>
    </div>
</div>

<h2 id="event_doneProc">Event: doneProc</h2>
{% highlight javascript %}
request.on('doneProc', function (rowCount, more, returnStatus, rows) { });
{% endhighlight %}

<p>
  Indicates the completion status of a stored procedure. This is also generated for stored procedures
  executed through SQL statements.
</p>
<p>
  This event may also occur when executing multiple calls with the same query using 
  <a href="api-connection.html#execSql"><code>execSql</code></a>.
</p>
<div class="argument">
  <div class="name">rowCount</div>
  <div class="description">
    <p>
      The number of result rows.
      May be <code>undefined</code> if not available.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">more</div>
  <div class="description">
    <p>
      If there are more result sets to come,
      then <code>true</code>.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">returnStatus</div>
  <div class="description">
    <p>
      The value returned from a stored procedure.
    </p>
  </div>
</div>
<div class="argument">
    <div class="name">rows</div>
    <div class="description">
        <p>
            Rows as a result of executing the SQL.
        </p>
        <p>
            Will only be avaiable if Connection's
            <code>config.options.rowCollectionOnDone</code>
            is <code>true</code>.
        </p>
    </div>
</div>

<h2 id="event_returnValue">Event: returnValue</h2>
{% highlight javascript %}
request.on('returnValue', function (parameterName, value, metadata) { });
{% endhighlight %}

<p>
  A value for an output parameter
  (that was added to the request with
  <a href="#function_addOutputParameter"><code>addOutputParameter(...)</code></a>).
</p>
<p>
  See also <a href="parameters.html"><code>Using Parameters</code></a>.
</p>
<div class="argument">
  <div class="name">parameterName</div>
  <div class="description">
    <p>
      The parameter name.
      (Does not start with '@'.)
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">value</div>
  <div class="description">
    <p>
      The parameter's output value.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">metadata</div>
  <div class="description">
    <p>
      The same data that is exposed in the <code>columnMetadata</code> event.
    </p>
  </div>
</div>

<h2 id="function_addParameter">request.addParameter(name, type, value, [options])</h2>
<p>
  Add an input parameter to the request.
</p>
{% highlight javascript %}
request.addParameter('city', TYPES.VarChar, 'London');
{% endhighlight %}
<p>
  See also <a href="parameters.html"><code>Using Parameters</code></a>.
</p>
<div class="argument">
  <div class="name">name</div>
  <div class="description">
    <p>
      The parameter name.
      This should correspond to a parameter in the SQL,
      or a parameter that a called procedure expects.
    </p>
    <p>
      The name should not start '@'.
    </p>
  </div>

  <div class="name">type</div>
  <div class="description">
    <p>
      One of the supported <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>

  <div class="name">value</div>
  <div class="description">
    <p>
      The value that the parameter is to be given.
      The Javascript type of the argument should match
      that documented for <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>

  <div class="name">options</div>
  <div class="description">
    <p>
      Additional type options. Optional.
      <ul>
        <li><code>length</code> for VarChar, NVarChar, VarBinary</li>
        <li><code>precision</code> for Numeric, Decimal</li>
        <li><code>scale</code> for Numeric, Decimal, Time, DateTime2, DateTimeOffset</li>
      </ul>
    </p>
  </div>
</div>

<h2 id="function_addOutputParameter">request.addOutputParameter(name, type, [value], [options])</h2>
<p>
  Add an output parameter to the request.
</p>
{% highlight javascript %}
request.addOutputParameter('id', TYPES.Int);
{% endhighlight %}
<p>
  The parameter's value will be provide by an emitted
  <a href="#event_returnValue"><code>returnValue</code></a> event.
</p>
<p>
  See also <a href="parameters.html"><code>Using Parameters</code></a>.
</p>
<div class="argument">
  <div class="name">name</div>
  <div class="description">
    <p>
      The parameter name.
      This should correspond to a parameter in the SQL,
      or a parameter that a called procedure expects.
    </p>
  </div>

  <div class="name">type</div>
  <div class="description">
    <p>
      One of the supported <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>

  <div class="name">value</div>
  <div class="description">
    <p>
      The value that the parameter is to be given.
      The Javascript type of the argument should match
      that documented for <a href="api-datatypes.html"><code>data types</code></a>. Optional.
    </p>
  </div>

  <div class="name">options</div>
  <div class="description">
    <p>
      Additional type options. Optional.
      <ul>
        <li><code>length</code> for VarChar, NVarChar, VarBinary</li>
        <li><code>precision</code> for Numeric, Decimal</li>
        <li><code>scale</code> for Numeric, Decimal, Time, DateTime2, DateTimeOffset</li>
      </ul>
    </p>
  </div>
</div>

<h2 id="function_pause">request.pause()</h2>
<p>
  Temporarily suspends the flow of data from the database.
  No more <code>'row'</code> events will be emitted until <a href="#function_resume"><code>request.resume()</code></a> is called.
</p>
{% highlight javascript %}
request.pause();
{% endhighlight %}
<p>
  If this request is already in a paused state, calling <code>pause()</code> has no effect.
</p>

<h2 id="function_resume">request.resume()</h2>
<p>
  Resumes the flow of data from the database.
</p>
{% highlight javascript %}
request.resume();
{% endhighlight %}
<p>
  If this request is not in a paused state, calling <code>resume()</code> has no effect.
</p>
